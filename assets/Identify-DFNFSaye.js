import{r as i,j as e}from"./index-CvOImPiD.js";import{a as R}from"./index-Dq7h7Pqt.js";import{N as O}from"./Navigation-BwshH00w.js";async function E(n){return(await R.post("https://my-api.plantnet.org/v2/identify/all?api-key=2b101VvCccv6Xmnzp0AnxRHOO",n)).data.results}const S=()=>{const[n,l]=i.useState(null),[d,f]=i.useState(null),[r,j]=i.useState(""),[m,u]=i.useState([]),[h,p]=i.useState(!1),[x,c]=i.useState(null),_=i.useRef(null),y=t=>{var a;const s=(a=t.target.files)==null?void 0:a[0];s&&(l(s),f(URL.createObjectURL(s)))},N=t=>{j(t.target.value)},v=t=>{const s=t.clipboardData.items;for(let a=0;a<s.length;a++){const g=s[a];if(g.type.indexOf("image")!==-1){const o=g.getAsFile();o&&(l(o),f(URL.createObjectURL(o)))}}},b=async()=>{if(!n){c("Пожалуйста, выберите изображение для определения растения.");return}p(!0),c(null),u([]);const t=new FormData;t.append("images",n),r&&t.append("organs",r);try{const s=await E(t);u(s||[])}catch(s){let a="Произошла ошибка при определении растения. Попробуйте позже.";s instanceof TypeError&&!navigator.onLine?a="Вы оффлайн. Проверьте подключение к интернету.":(typeof s=="object"&&s!==null&&"code"in s&&s.code==="ERR_NETWORK"||s instanceof TypeError)&&(a="Не удалось подключиться к серверу. Включите VPN или откройте сайт в другом браузере."),c(a),console.error("Ошибка при определении растения:",s)}finally{p(!1)}};return i.useEffect(()=>{var t;(t=_.current)==null||t.focus()},[]),e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsx("div",{className:"nav__offset"}),e.jsx("main",{className:"identify",children:e.jsxs("div",{className:"identify__container",onPaste:v,ref:_,tabIndex:0,children:[e.jsx("h1",{className:"identify__title",children:"Узнать растение по фото"}),e.jsx("p",{className:"identify__hint",children:"Сделайте чёткое фото листа или цветка или вставьте скриншот с буфера обмена (Ctrl + V)"}),e.jsxs("div",{className:"identify__upload",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:y,className:"identify__file"}),d&&e.jsx("img",{src:d,alt:"Превью изображения",className:"identify__preview"}),e.jsx("p",{className:"identify__organ-label",children:"Уточните, что изображено на фото — это поможет точнее определить растение:"}),e.jsxs("select",{className:"identify__select",value:r,onChange:N,children:[e.jsx("option",{value:"",children:"Неизвестно"}),e.jsx("option",{value:"leaf",children:"Лист"}),e.jsx("option",{value:"flower",children:"Цветок"}),e.jsx("option",{value:"fruit",children:"Плод"}),e.jsx("option",{value:"bark",children:"Кора"}),e.jsx("option",{value:"habit",children:"Растение целиком"})]}),e.jsx("button",{className:"identify__button",onClick:b,disabled:h,children:h?"Определение...":"Определить"}),x&&e.jsx("div",{className:"identify__error",children:x})]}),m.length>0&&e.jsx("ul",{className:"identify__results",children:m.map((t,s)=>{var a;return e.jsxs("li",{className:"identify__result",children:[((a=t.images)==null?void 0:a.length)>0&&e.jsx("img",{src:t.images[0].url.s,alt:"Изображение растения",className:"identify__result-image"}),e.jsxs("div",{className:"identify__result-info",children:[e.jsx("h3",{className:"identify__result-name",children:t.species.scientificNameWithoutAuthor}),e.jsxs("p",{className:"identify__result-score",children:["Вероятность:"," ",(t.score*100).toFixed(1),"%"]})]})]},s)})})]})})]})};export{S as default};
